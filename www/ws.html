<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WS-DEMO</title>
</head>
<body>

<style>
    .div_block{
        border:1px solid #000;
        width:30px;
        height:30px;
    }
</style>

<script src="jquery.min.js" type="text/javascript"></script>
<script src="sync.js" type="text/javascript"></script>

<div id="p1" style="float: left;border:1px solid #cad9ea;"></div>
<div id="p2" style="border:1px solid #cad9ea" ></div>

<br/><br/>

<div id="p3" style="float: left;border:1px solid #cad9ea"></div>
<div id="p4" style="border:1px solid #cad9ea"></div>

<br/><br/>
<br/><br/>
</body>


<script type="text/javascript">
    var domain = window.location.host;
    var serverHostUri = "http://"+domain + "/www/getServer";
    $.ajax({
        // data: {username:$("#username").val(), content:$("#content").val()},
        // dataType: "json",
        type: "GET",
        // url: "http://192.168.192.91:2222/www/getServer",
        // url: "http://127.0.0.1:2222/www/getServer",
        url:serverHostUri,
        success: function(data){
            init(data);
        }
    });

    var player1 = {"id":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjEsIkV4cGlyZSI6MTYxNzMyOTk2MywiQVRpbWUiOjE2MTcyNDM1NjMsIkFwcElkIjoxfQ.XxbHWdSZx4WvXklXHfCWjSpJAIZo2aVv4aUuD3SNsIE"};
    var player2 = {"id":2,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjIsIkV4cGlyZSI6MTYxNzc5NzUyMSwiQVRpbWUiOjE2MTc3MTExMjEsIkFwcElkIjoxfQ.vKWg0rKfanCZEWBoR4WfuHBAPj5-cH_AxY21YO_RUlk"};
    var player3 = {"id":3,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjMsIkV4cGlyZSI6MTYxODQ1ODI1NywiQVRpbWUiOjE2MTgzNzE4NTcsIkFwcElkIjoxfQ.cUQcIdUGsExH4nrzQ49QPvxvPwZJ1N30OP9Sn9KX300"};
    var player4 = {"id":4,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjQsIkV4cGlyZSI6MTYxODQ1ODI5NSwiQVRpbWUiOjE2MTgzNzE4OTUsIkFwcElkIjoxfQ.5pgyy2Pn13q9nwTbP4_CGBNxUnDHUCNDwFHOdwDt1ck"};

    // var wsObj1 = null;
    // var wsObj2 = null;


    var domIdPre = {
        "seq":"seqId_",
        "map":"mapId_",
        "room":"roomId_",
        "optBnt":"optBntId_",
        "randSeek":"randSeekId_",
        "moveUp":"moveUp_",
        "moveLeft":"moveLeft_",
        "moveRight":"moveRight_",
        "moveDown":"moveDown_",
    };

    function getPlayerDomIdPreObj(pid){
        var rrVV = {
            "seqId":domIdPre.seq+pid,
            "roomId":domIdPre.room+pid,
            "mapId":domIdPre.map +pid,
            "optBntId":domIdPre.optBnt+pid,
            "randSeekId":domIdPre.randSeek+pid,
            "moveUp":domIdPre.moveUp+pid,
            "moveLeft":domIdPre.moveLeft+pid,
            "moveRight":domIdPre.moveRight+pid,
            "moveDown":domIdPre.moveDown+pid,
        };
        return rrVV;
    }

    function initPlayer(player,divId,data){
        var host = "ws://"+data.Host + ":"+ data.Port;
        var hostUri = data.Uri;
        var matchGroupPeople = data.RoomPeople;
        var tableMax = data.MapSize;
        var OffLineWaitTime = data.OffLineWaitTime;

        var DomIdPreObj = getPlayerDomIdPreObj(player.id);
        DomIdPreObj.playerId = player.id;
        var wsObj = new ws(player.id,player.token,host,hostUri,matchGroupPeople,tableMax,DomIdPreObj,OffLineWaitTime,data.ActionMap);
        var html = getTemplateHtml();
        html = ReplaceTemplateHtml(html,DomIdPreObj);
        $("#"+divId).html(html);
        $("#"+DomIdPreObj.optBntId).click(wsObj.create);

        $("#"+DomIdPreObj.moveUp).click("up",wsObj.move);
        $("#"+DomIdPreObj.moveLeft).click("left",wsObj.move);
        $("#"+DomIdPreObj.moveRight).click("right",wsObj.move);
        $("#"+DomIdPreObj.moveDown).click("down",wsObj.move);

        wsObj.getMap("mapId_"+player.id);
    }

    function init(data){
        initPlayer(player1,"p1",data);
        initPlayer(player2,"p2",data);
        initPlayer(player3,"p3",data);
        initPlayer(player4,"p4",data);
    }

    function ReplaceTemplateHtml(html,DomIdPreObj){
        for(let key  in DomIdPreObj){
            html = html.replace("{{"+key +"}}",DomIdPreObj[key]);
        }
        return html;
    }

    function getTemplateHtml(){
        var html  = '<table>\n' +
            '    <tr>\n' +
            '        <td>seqId:<span id="{{seqId}}"></span></td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>roomId：<span id="{{roomId}}" ></span></td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>randSeek：<span id="{{randSeekId}}" ></span></td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>绿色:自己</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>红色:对方</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td width="50%">\n' +
            '            <div>\n' +
            '                player_{{playerId}}\n' +
            '            </div>\n' +
            '            <table id="{{mapId}}"></table>\n' +
            '\n' +
            '            <table>\n' +
            '                <tr>' +
            '                   <td></td>' +
            '                   <td id="{{moveUp}}"><a href="javascript:void(0)"  >上</a></td><td></td>' +
            '                </tr>\n' +
            '                <tr>' +
            '                   <td id="{{moveLeft}}"><a href="javascript:void(0)"  >左</a></td><td></td>' +
            '                   <td id="{{moveRight}}"><a href="javascript:void(0)"  >右</a></td>' +
            '                </tr>\n' +
            '                <tr>' +
            '                   <td></td>' +
            '                   <td id="{{moveDown}}"><a href="javascript:void(0)"  >下</a></td><td></td>' +
            '                </tr>\n' +
            '            </table>\n' +
            '\n' +
            '            <div>\n' +
            '                <div id="{{optBntId}}">\n' +
            '                    <a href="javascript:void(0);">连接</a>\n' +
            '                </div>\n' +
            '\n' +
            '            </div>\n' +
            '        </td>\n' +
            '\n' +
            '    </tr>\n' +
            '</table>';
        return html;
    }

</script>


</html>