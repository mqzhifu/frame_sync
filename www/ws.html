<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WS-DEMO</title>
</head>
<body>

<style>
    .div_block{
        border:1px solid #000;
        width:30px;
        height:30px;
    }
</style>

<script src="jquery.min.js" type="text/javascript"></script>
<script src="sync.js" type="text/javascript"></script>

<div id="p1" style="float: left"></div>
<div id="p2"></div>

</body>


<script type="text/javascript">
    $.ajax({
        // data: {username:$("#username").val(), content:$("#content").val()},
        // dataType: "json",
        type: "GET",
        url: "http://127.0.0.1:2222/www/getServer",
        success: function(data){
            init(data);
        }
    });

    var player1 = {"id":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjEsIkV4cGlyZSI6MTYxNzMyOTk2MywiQVRpbWUiOjE2MTcyNDM1NjMsIkFwcElkIjoxfQ.XxbHWdSZx4WvXklXHfCWjSpJAIZo2aVv4aUuD3SNsIE"};
    var player2 = {"id":2,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjIsIkV4cGlyZSI6MTYxNzc5NzUyMSwiQVRpbWUiOjE2MTc3MTExMjEsIkFwcElkIjoxfQ.vKWg0rKfanCZEWBoR4WfuHBAPj5-cH_AxY21YO_RUlk"};

        var wsObj1 = null;
    var wsObj2 = null;


    var domIdPre = {
        "seq":"seqId_",
        "map":"mapId_",
        "room":"roomId_",
        "optBnt":"optBntId_",
        "randSeek":"randSeekId_",
    };

    function getPlayerDomIdPreObj(pid){
        var rrVV = {
            "seqId":domIdPre.seq+pid,
            "roomId":domIdPre.room+pid,
            "mapId":domIdPre.map +pid,
            "optBntId":domIdPre.optBnt+pid,
            "randSeekId":domIdPre.randSeek+pid,
        };
        return rrVV;
    }

    function initPlayer(player,divId,data){
        // var hostUri = "/ws";
        var host = "ws://"+data.Host + ":"+ data.Port;
        var hostUri = data.Uri;
        var matchGroupPeople = data.RoomPeople;
        var tableMax = data.MapSize;
        //
        // var token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjEsIkV4cGlyZSI6MTYxNzMyOTk2MywiQVRpbWUiOjE2MTcyNDM1NjMsIkFwcElkIjoxfQ.XxbHWdSZx4WvXklXHfCWjSpJAIZo2aVv4aUuD3SNsIE";

        // wsObj1 = new ws(1,token,host,hostUri,matchGroupPeople,tableMax);
        // wsObj1.getMap("map1");
        //
        // var token ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVaWQiOjIsIkV4cGlyZSI6MTYxNzc5NzUyMSwiQVRpbWUiOjE2MTc3MTExMjEsIkFwcElkIjoxfQ.vKWg0rKfanCZEWBoR4WfuHBAPj5-cH_AxY21YO_RUlk";
        // wsObj2 = new ws(2,token,host,hostUri,matchGroupPeople,tableMax);
        // wsObj2.getMap("map2");

        var DomIdPreObj = getPlayerDomIdPreObj(player.id);
        var wsObj = new ws(player.id,player.token,host,hostUri,matchGroupPeople,tableMax,DomIdPreObj);
        var html = getTemplateHtml();
        html = ReplaceTemplateHtml(html,DomIdPreObj);
        $("#"+divId).html(html);
        $("#"+DomIdPreObj.optBntId).click(wsObj.create);
        wsObj.getMap("mapId_"+player.id);
    }


    function init(data){
        initPlayer(player1,"p1",data);
        initPlayer(player2,"p2",data);
    }



    // function player1Link(){
    //     wsObj1.create();
    //     $("#opt_bnt1").html("等待中...");
    // }
    //
    // function player2Link(){
    //     wsObj2.create();
    //     $("#opt_bnt2").html("等待中...");
    // }

    // function move(playerId,dir){
    //     if(playerId == 1){
    //         wsObj1.move(dir);
    //     }else{
    //         wsObj2.move(dir);
    //     }
    // }

    function ReplaceTemplateHtml(html,DomIdPreObj){
        for(let key  in DomIdPreObj){
            html = html.replace("{{"+key +"}}",DomIdPreObj[key]);
        }
        return html;
    }

    function getTemplateHtml(){
        var html  = '<table>\n' +
            '    <tr>\n' +
            '        <td>seqId:<span id="{{seqId}}"></span></td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>roomId：<span id="{{roomId}}" ></span></td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>randSeek：<span id="{{randSeekId}}" ></span></td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>绿色:自己</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>红色:对方</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td width="50%">\n' +
            '            <div>\n' +
            '                player1\n' +
            '            </div>\n' +
            '            <table id="{{mapId}}"></table>\n' +
            '\n' +
            '            <table>\n' +
            '                <tr><td></td><td><a href="#" onclick="move(1,\'up\')">上</a></td><td></td></tr>\n' +
            '                <tr><td><a href="#" onclick="move(1,\'left\')">左</a></td><td></td><td><a href="#" onclick="move(1,\'right\')">右</a></td></tr>\n' +
            '                <tr><td></td><td><a href="#" onclick="move(1,\'down\')">下</a></td><td></td></tr>\n' +
            '            </table>\n' +
            '\n' +
            '            <div>\n' +
            '                <div id="{{optBntId}}">\n' +
            '                    <a href="javascript:void(0);">连接</a>\n' +
            '                </div>\n' +
            '\n' +
            '            </div>\n' +
            '        </td>\n' +
            '\n' +
            '    </tr>\n' +
            '</table>';
        return html;
    }

</script>


</html>